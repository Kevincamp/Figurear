<!DOCTYPE html>
<html>
	<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <script src="js/three.js"></script>
		<script type="text/javascript" src="js/poly2tri.js"></script>
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <title>Figurear</title>
    </head>
    <body onload="webGLStart()">
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <titulo> Figurear </titulo>
        <div id="wrapper"
                    onmousedown="mouseDownEvent(event.clientX, event.clientY)"
                    onmousemove="mouseMoveEvent(event.clientX, event.clientY)"
                    onmouseup="mouseUpEvent(event.clientX, event.clientY)"
                    oncontextmenu="return false;">
            <div class="water-drop"></div>
            <div class="button button-floating"></div>
            <div class="button-floating-shadow"></div>
            <div class="button button-sub" data-color="purple">
            </div>
            <div class="button button-sub" data-color="green">
            </div>
            <div class="button button-sub" data-color="pink">
            </div>
            <div class="button button-sub" data-color="indigo">
            </div>
        </div>
        <footer>
            By <a href="" target="_blank">Adrian Aguilar </a> //
            <a href="" target="_blank">Kevin Campuzano </a> // 
            <a href="" target="_blank">Marlon Loayza </a>
        </footer>
        <script type="text/javascript">

            /* Declaracion de variables */
            var cantidadTachuela = 0;
            var puntoInicial = null;
            var puntoFinal = null;
            var puntos_figura = [];
            var puntos_remuestreados =[];
            var listaLineasFigura=[];
            var listaTriangulosFigura=[];
            var listaTriangulos =[];
            var puntos_malla=[];
            var list_lineas=[];
            var lista_tachuelas = [];
            var pressed = false;
            var container;
            var camera, scene, projector, renderer;
            var particleMaterial;
            var isRotating=false;
            var nuevo=false;
            var mover=false;
            var tachuela = false;
            var first_pos ;
            var last_pos;


            
            /* -- Eventos de Botones -- ******************************************* */
            function doNew(){
                console.info("entro a doNew");
                puntos_figura.splice(0,puntos_figura.length);
                puntos_remuestreados.splice(0,puntos_remuestreados.length);
                listaLineasFigura.splice(0,listaLineasFigura.length);
                puntos_malla.splice(0,puntos_malla.length);
                list_lineas.splice(0,list_lineas.length);
                lista_tachuelas.splice(0,lista_tachuelas.length);
                listaTriangulosFigura.splice(0,listaTriangulosFigura.length);
                listaTriangulos.splice(0,listaTriangulos.length);
                cantidadTachuela=0;
                nuevo = true;
                mover=false;
                tachuela = false;
                pressed=false;
                initState();
            }

            function putTach(){
                console.info("Entro a poner tachuelas");
                tachuela = true;
                mover = false;
                nuevo = false;
                pressed=false;
            }

            function moveTach(){
                console.info("Entro a Translacion.");
                tachuela = false;
                mover = true;
                nuevo = false;
            }

            /* -- Fin de Eventos de Botones -- ******************************************* */

            $(document).ready(function() {
                $(".button-floating").click(function() {
                    var $wrapper = $("#wrapper");

                    if (!$wrapper.hasClass("button-floating-clicked"))
                    {
                        $wrapper.attr("class", "center");
                        $wrapper.toggleClass("button-floating-clicked-out");
                    }

                    $wrapper.toggleClass("button-floating-clicked");

                    $(".button-sub").click(function() {
                        var color = $(this).data("color");

                        if(color == "purple"){
                            console.info("Dibuja");
                            doNew();
                        } else if(color == "green"){
                            console.info("Tachuela");
                            putTach();
                        } else if(color == "pink"){
                            console.info("Mueve");
                            moveTach();
                        }else if (color == "indigo"){
                            console.info("Guarda");
                        }else{
                            console.info("No hace nada");
                        }
                        $wrapper.attr("class", "button-floating-clicked");
                        $wrapper.addClass("button-sub-" + color + "-clicked");
                    });
                });
            });


            function mouseDownEvent(x, y) {
                p = get3dPointZAxis(event);
                var pos=new THREE.Vector3(p.x,p.y+70,0);
                                   

                if (nuevo){
                    puntos_figura.length = 1;
                    puntos_figura[0] = new THREE.Vector3(pos.x, pos.y, 0);
                    first_pos = puntos_figura[0];
                    nuevo=false;
                    pressed=true;
                    
                }
                if(tachuela && cantidadTachuela<1){
                    cantidadTachuela ++;
                    console.log("ingresando tachuela");
                    agregarTachuela(pos.x, pos.y);
                    //lista_tachuelas.push(punto);
                    tachuela = false
                    pressed = false
                    

                }
                if(mover) {
                    var tachue=lista_tachuelas[0];
                    var x= tachue.position.x;
                    var y= tachue.position.y;
                    if (pos.x<= (x+10) && pos.x>=(x-10) && pos.y<= (y+10) && pos.y>= (y-10)){
                        pressed=true;
                    }
                }   
            }

            function mouseMoveEvent(x,y) {

            }

            function mouseUpEvent(x,y) {

            }

            function webGLStart() {
                console.info("Entro a WebGLStart");
                init();
            }
            function init(){
                console.info("Entro a init");
                render = new THREE.WebGLRenderer();
                render.setClearColor(0xE6E6E6, 1);
                render.setSize(document.getElementById("wrapper").width, document.getElementById("wrapper").canvasHeight);
                document.getElementById("wrapper").appendChild(render.domElement);
                initState();
            }

            function initState(){
                console.info("Entro a initState");
                camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
                camera.position.set( 500, 500, 500 );
                scene = new THREE.Scene();
            }
            
        </script>
    </body>
</html>
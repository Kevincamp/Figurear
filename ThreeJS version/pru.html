<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="/js/jquery-1.7.2.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<!--[if IE]><script type="text/javascript" src="/excanvas.js"></script><![endif]-->
<script type="text/javascript">
    // Variables para contener los sucesivos puntos (x,y) por los que va
    // pasando el ratón, y su estado (pulsado/no pulsado)
    var movimientos = new Array();
    var pulsado;
    function crearLienzo() {
        //Aquí es donde vamos a insertar el código javascript para crear el lienzo
        var canvasDiv = document.getElementById('lienzo');
        canvas = document.createElement('canvas');
        canvas.setAttribute('width', 600);
        canvas.setAttribute('height', 600);
        canvas.setAttribute('id', 'canvas');
        canvasDiv.appendChild(canvas);
        
        
        if(typeof G_vmlCanvasManager != 'undefined') {
            canvas = G_vmlCanvasManager.initElement(canvas);
        }
        context = canvas.getContext("2d");

        $('#canvas').mousedown(function(e){
            // Deja la pantalla encerada para un nuevo dibujo.
            movimientos = new Array();
            repinta();
            
            //Empieza a dibujar
            pulsado = true;
            movimientos.push([e.pageX - this.offsetLeft, e.pageY - this.offsetTop,false]);
            repinta();
            });

        $('#canvas').mousemove(function(e){
            if(pulsado){
            movimientos.push([e.pageX - this.offsetLeft, e.pageY - this.offsetTop,true]);
            repinta();
              }
            });

        $('#canvas').mouseup(function(e){
            pulsado = false;
            });

        $('#canvas').mouseleave(function(e){
            pulsado = false;
            });
        repinta();


    }
    function completarFigura(){
        // funcion para completar figura, es decir que la figura quede cerrada.
        // obteniendo la primera posicion y la ultima de la lista de movimientos.
        var pos_init = movimientos[0]
        var pos_final = movimientos[movimientos.length]
        
    }

    function repinta() {
        // función para dibujar en el lienzo los movimientos del ratón que hemos
        // recogido en la variable "movimientos"
        canvas.width = canvas.width; // Limpia el lienzo

        context.strokeStyle = "#0000a0";
        context.lineJoin = "round";
        context.lineWidth = 6;

        for(var i=0; i < movimientos.length; i++)
        {
          context.beginPath();
          if(movimientos[i][2] && i){
            context.moveTo(movimientos[i-1][0], movimientos[i-1][1]);
          }else{
            context.moveTo(movimientos[i][0], movimientos[i][1]);
          }
          context.lineTo(movimientos[i][0], movimientos[i][1]);
          context.closePath();
          context.stroke();
          }
    }

</script>
</head>
<body style="background: #eee;" onload="crearLienzo();">
<div id="lienzo" style="width: 600px; height: 600px; background: #fff; border:3px solid #000000;"></div>
</body>
</html>
